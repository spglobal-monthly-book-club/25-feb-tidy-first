# 관리 - CHAPTER 16 ~ 18

16. 코드 정리는 별도의 PR로 만들고, 가급적 PR당 몇 개의 코드 정리만 넣자.

17. 코드를 계속 정리하고 싶은 충동을 관리하기 위해서, 아주 작은 단계('코드 정리법'의 각 단계)로 나누어 코드를 정리하는 방식을 고수하면서 실험하자.

18. 일괄 처리 규모를 줄이면 검토 비용과 코드 정리 비용을 줄일 수 있다. 즉, 한 번에 하나씩 정리와 검토를 반복하자.

---

### 🚀 CHAPTER 16. 코드 정리 구분

코드 정리는 어디서 해야할까?

불쌍사나운 모습이 이어지는 한 가지 사례를 살펴보자.

1. 동작 변경 코드와 함께 내가 만든 코드 정리 내용을 넣는다.
2. 검톨하던 사람들이 내가 만든 PR이 너무 길다고 불평한다.
3. 내가 만든 코드 정리 내용을 분리해서, 동작 변경 PR 앞이나 뒤에 둔다.
4. 검토하는 사람들이 코드 정리만 담긴 PR에 대해 무슨 의미로 만들었는지 모르겠다고 불평한다.
5. 다시 1로 돌아간다.

코드 정리를 하지 않는다면 모를까, 코드 정리를 하면 어딘가에서는 처리해야 한다. 그럼 어디서 해야할까?

- 요약하면, **코드 정리는 별도의 PR로 만들고, 가급적 PR당 몇 개의 코드 정리만 넣는다.**

코드 정리를 배우는 사람들은 예상되는 단계들을 거치게 된다.

1. 첫 단계에서는 그냥 변경 작업을 하는 즉, 변경을 구분하지 않은 상태에서 다수의 변경을 반영하기 시작한다.

   - 예를 들어, `if` 문을 변경하는 도중에 이름이 잘못되었다는 것을 깨닫고 이름을 변경한 후 다시 `if` 문으로 돌아가는 경우를 생각해보자

   - 변경 대상 중에는 프로그램 동작 변경이 있다. 이러한 변경은 프로그램을 실행하면서 찾아낸 것이다.

     - 이런 종류의 변경은 코드를 자세히 살펴봐야만 관찰할 수 있다.

   - 이 시점에서는 아직 계획도 없고, 바뀌는 동작 변경과 구조 변경 사이에 어떤 흐름도 없다.

     - 서로 다른 두 가지가 함께 작용하고 있다고 이제 막 인식했을 뿐이다.

   => **다양한 변경 필요성을 구분하지 않은 상태에서 변경 시도**

2. 공통 흐름을 알아채기 시작한다.

   - 비슷한 코드끼리 정리하면 설명하는 도우미가 드러나고, 설명하는 도우미를 만들면 이어지는 동작 변경이 훨씬 쉬워진다.

   - 이렇게 되면 프로그래밍이 체스와 비슷해져서 게임이 어떤 순서로 전개될지 보이고, 몇 수 앞을 짐작할 수 있다.

   => **순서를 부여한 동작 변경과 구조 변경**

3. 변경 사항을 나누어 별도의 PR로 만든다.

   - 아직 큰 PR 한 개에 섞여 있으면, 쉽게 엉망이 되어벼려 검토자들을 일단 주저하게 만든다.

   - 한 수씩 둘 때마다 다분히 의도적으로, 쉽게 변경하던가 또는 변경하기 쉽게 만들던가, 둘 중 하나를 목표로 삼는 것이 좋다.

   - 순서가 있는 일련의 코드 정리는 (심지어 하나의 정리만 있더라도) PR 한 개로 만든다.

   - 동작 변경 역시 별도의 PR로 만든다.

   - 코드 정리와 동작 변경 사이를 번갈아 가면서 전환할 때마다 새 PR을 열어야 한다.

   => **별도의 PR에 포함된 동작 변경과 구조 변경**

작은 PR은 보통 검토 시간 단축으로 환영 받는다.

- 코드를 신속히 검토할 수 있다.

- 초점이 분명할수록 PR은 더 빠른 검토를 장려한다.

---

### 🚀 CHAPTER 17. 연쇄적인 정리

코드를 계속 정리하고 싶은 충동을 관리하는 것도 코드 정리의 핵심 기술이다.

단계의 크기는 본인이 알아서 하겠지만, 이 책에서 권하는 것은 **아주 작은 단계(1장 '코드 정리법'의 각 단계)로 나누어 코드를 정리하는 방식을 고수하면서 실험해 보는 것**이다.

- 그러면서 각 단계를 최적해보자.

- 밖에서 보면 그저 빠르게 달리는 것처럼 보이지만, 스스로가 지네처럼 작은 발걸음을 차례차례 내딛을 수 있게.

**소프트웨어 개발에서 변경은 가장 많은 비용이 들어간다.**

- 변경 중에서도 코드를 이해하는 일에 가장 비용이 많이 들어간다.

- ⭐️ **따라서, 작동하는 코드의 구조와 의도에 대해 잘 소통하는 것이야말로 익혀야 할 가장 가치 있는 기술이다.**

- 주석은 의사소통의 한 형태이긴 하지만, 코드 정리는 다른 프로그래밍 요소들의 도움을 받아, 의사소통이 어디까지 가능한지 나아갈 수 있기 해준다.

코드 구조를 대대적으로 바꾸려고 코드 정리를 시작하는 경우가 많다. 너무 많이, 너무 빠르게 변경하지 않도록 주의하자.

- 대게 작은 정리를 순차적으로 성공하는 것이 무리한 정리로 실패하는 것보다 시간을 아껴준다.

- 악보의 음표를 다루듯이 코드를 정리하는 연습을 하자. 음표가 깨끗하고 편안할 때 이를 이용해서 더 좋은 멜로디를 만들 수 있다.

---

### 🚀 CHAPTER 18. 코드 정리의 일괄 처리량

통합과 배포를 하기 전에 코드 정리는 어느 정도 크기가 적절할까?

몇 가지 고려해야 할 사항이 있다.

- 통합과 배포를 하기 전에 얼마나 많은 코드 정리를 해야 할까?

  - 즉, 코드 정리를 다음 동작 변경을 돕는 구조 변경으로 본다면, 다음 동작 변경을 지원하기 위해 얼마나 많은 구조 변경이 필요할까?

  - 기본적으로 코드 정리는 먼 미래를 바라보는 것이 아니기 때문에 즉각적인 필요를 다뤄야 한다. (CHAPTER 21 에서 설명)

- 코드 정리의 크기가 어느 정도일 때 쉽게 통합하고 배포할 수 있을까?

CHAPTER 16 '코드 정리 구분'에서는 코드 정리와 동작 변경을 섞지 않는 것에 대해 설명했었다. 하지만 모든 코드 정리를 한꺼번에 할 것인지, 아니면 모두 개별적으로 할 것인지, 아니면 그 중간을 택할 것인지에 대한 의문은 여전히 남아있다.

이로 인해 골디락스 딜레마로 알려진 타협접이 필요한 상황을 만나게 된다.

- 일괄 처리하는 코드 정리가 너무 많은 경우와 너무 적은 경우, 그리고 적절한 경우의 범위를 판단할 때, 고려할 만한 비용은 무엇일까?

**일괄 처리당 코드 정리 수가 많아질수록 충돌, 상호작용, 추측과 같은 비용이 증가한다.**

- 충돌

  - 일괄 처리하는 코드 정리 작업이 많을수록, 통합 과정에서 지연 시간이 길어지고, 코드 정리 작업이 다른 사람의 진행 중인 작업과 충돌할 가능성도 커진다.

  - 코드 병합 과정에서 충돌이 발생할수록 작업을 병합하는 비용 또한 큰 폭으로 증가한다.

- 상호작용

  - 다수의 코드 정리를 한번에 처리하다가 우연히 동작 변경을 할 수도 있다.

  - 코드 정리 사이에 상호작용이 있으면 병합 비용은 급격히 증가한다.

- 추측

  - 다음 동작 변경에 도움이 될 만큼만 코드 정리를 하는 것이 좋다고 했었다. 하지만, 한 번에 처리하는 코드 정리가 많을수록 자연스럽게 더 많은 코드를 정리하게 된다.

  - 그로 인해 예상치 못한 추가 비용이 발생한다.

이러한 요인으로 인해 보통 한 번에 처리하는 코드 정리 개수를 줄인 후 통합과 배치에 임한다.

하지만 여전히 대량의 코드 정리를 일괄로 처리하는 현장을 많이 볼 수 있다. 또 뭇흔 일이 일어나고 있는 걸까?

**많은 조직에서 하나의 변경 사항을 검토하고 배포하는 데 드는 고정 비용은 상당히 많다.**

- **일괄 처리당 코드 정리 수가 적어질수록 검토 비용이 증가한다.**

- 프로그래머는 이러한 비용을 체감하기 때문에 충돌, 상호작용, 추측으로 인한 비용이 증가됨에도 타협점을 찾으려고 노력한다.

그럼 대체 어떻게 해야 할까?

- 어떤 이들은 이러한 비용을 개발 세상의 물리 법칙인 양 그저 받아들여야 하는 일로 다룬다.

- 하지만 전혀 그렇지 않다. 코드 정리 비용을 줄이고자 한다면, 코드 정리 개수를 늘려서 동작 변경에 소용되는 비용을 줄이자.

- 그러면 검토 비용을 줄일 수 있다.

**일괄 처리 규모를 줄이면 검토 비용이 줄고 코드 정리 비용도 줄어든다.**

팀은 검토 비용을 제대로 줄일 수 있는 방법을 찾아야 한다.

- 팀에 신뢰와 강력한 문화가 있다면 코드 정리 후에는 굳이 검토할 필요가 없다.

- 검토하지 않더라도 코드 정리가 소프트웨어 안정을 해치지 않으면 상호작용의 위험이 줄어든다.

코드 정리 검토를 없앨 수준의 안전과 신뢰에 도달하려면, 적어도 몇 달이 걸린다.

- 실천하고, 실험하자. 오류를 팀과 함께 검토하자.
